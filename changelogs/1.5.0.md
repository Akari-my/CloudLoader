# Changelog

All notable changes to this project will be documented in this file.

---

## [1.5.0]

### Added
- Configurable staging system:
  - `staging.strategy: symlink|copy`
  - `staging.reset_on_start: true|false`
- Deterministic dependency resolution:
  - When multiple modules are ready to load, ordering is now stable and alphabetical to ensure consistent load order across restarts.
- Module registry support via `plugin_data/CloudLoader/modules.yml`:
  - `disabled:` list to exclude modules from loading
  - `enabled:` list activates whitelist mode (only listed modules are allowed)
- New management commands:
  - `/cloudloader list` shows discovered modules and their state (loaded/pending/disabled/missing_deps/cycle)
  - `/cloudloader status <PluginName>` displays module details (dependencies, path, staging path, skip reason)
  - `/cloudloader graph` prints a dependency overview (`A -> B, C`)
  - `/cloudloader enable <PluginName>` enables a module in the registry (and enables the plugin if already loaded)
  - `/cloudloader disable <PluginName>` disables a module in the registry (and disables the plugin if currently enabled; restart recommended)
- Improved logging:
  - Final summary line after each load with counts (discovered/allowed/already_present/staged/enabled/skipped/errors)
  - `logs.debug: true` for additional registry/debug information
- Cleaner internal structure:
  - Module loading logic moved out of the main plugin class into a dedicated `CloudModuleManager`.
  - Commands refactored to support subcommand classes for better organization and maintainability.

### Changed
- Plugin loading now uses a staging directory approach compatible with PocketMine-MP 5 plugin loading rules.
- Dependency ordering now accounts for `depend`, `softdepend`, and `loadbefore` for closer-to-native ordering behavior.
- Staging behavior on Windows is more transparent:
  - When symlink creation fails, CloudLoader falls back to copying and logs the reason clearly.

### Fixed
- PocketMine-MP 5 compatibility improvements:
  - Removed direct calls to protected lifecycle methods like `onLoad()`.
  - Removed reliance on deprecated/removed logger and permission defaults APIs.
- Reduced nondeterministic behavior caused by filesystem scan order.

### Notes
- CloudLoader supports **folder-based plugins only** (no `.phar` modules).
- PocketMine-MP does not support fully unloading plugins safely; disabling a loaded plugin may still require a server restart for a clean state.